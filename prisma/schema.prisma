// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id               String    @id @default(cuid())
  email            String    @unique
  name             String?
  passwordHash     String?   // For email/password auth
  emailVerifiedAt  DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  deletedAt        DateTime?
  
  // Relations
  projects         Project[]
  recommendations   Recommendation[]
  
  @@map("users")
}

model Project {
  id                String   @id @default(cuid())
  userId            String
  name              String
  description       String?
  requirementsData  Json?    // Stores structured project requirements
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // Relations
  user              User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  recommendations   Recommendation[]
  
  @@map("projects")
}

model Technology {
  id                     String   @id @default(cuid())
  name                   String
  slug                   String   @unique
  categoryId             String
  description            String
  websiteUrl             String?
  documentationUrl       String?
  repositoryUrl          String?
  licenseType            String?
  firstReleaseDate       DateTime?
  lastStableReleaseDate  DateTime?
  currentVersion         String?
  keyFeatures            Json?    // List of features
  typicalUseCases        Json?    // Use case descriptions
  advantages             String?  // Pros
  disadvantages          String?  // Cons
  communitySupportInfo   String?
  learningCurve          String?  // Easy, Moderate, Steep
  performanceNotes       String?
  scalabilityNotes       String?
  integrationNotes       String?
  securityConsiderations String?
  logoUrl                String?
  isActive               Boolean  @default(true)
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  
  // Relations
  category               TechnologyCategory @relation(fields: [categoryId], references: [id])
  tags                   TechnologyTagMapping[]
  compatibility1         TechnologyCompatibility[] @relation("Technology1")
  compatibility2         TechnologyCompatibility[] @relation("Technology2")
  
  @@map("technologies")
}

model TechnologyCategory {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  technologies Technology[]
  
  @@map("technology_categories")
}

model Recommendation {
  id                    String   @id @default(cuid())
  projectId             String
  userId                String   // Add userId for the relation
  generatedAt           DateTime @default(now())
  recommendationSnapshot Json?    // Full recommendation data
  
  // Relations
  project               Project @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user                  User    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("recommendations")
}

model TechnologyCompatibility {
  id               String   @id @default(cuid())
  technology1Id    String
  technology2Id    String
  compatibilityType String  // Compatible, Incompatible, Commonly Used With, etc.
  notes            String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  
  // Relations
  technology1      Technology @relation("Technology1", fields: [technology1Id], references: [id], onDelete: Cascade)
  technology2      Technology @relation("Technology2", fields: [technology2Id], references: [id], onDelete: Cascade)
  
  @@unique([technology1Id, technology2Id, compatibilityType])
  @@map("technology_compatibility")
}

model TechnologyTag {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
  
  // Relations
  tagMappings TechnologyTagMapping[]
  
  @@map("technology_tags")
}

model TechnologyTagMapping {
  technologyId String
  tagId        String
  
  // Relations
  technology   Technology @relation(fields: [technologyId], references: [id], onDelete: Cascade)
  tag          TechnologyTag @relation(fields: [tagId], references: [id], onDelete: Cascade)
  
  @@id([technologyId, tagId])
  @@map("technology_tag_mappings")
}

model SampleTechStack {
  id                    String   @id @default(cuid())
  name                  String
  description           String
  applicationTypeContext String? // Web App, API, etc.
  stackComponentsData   Json     // Array of technology choices with rationale
  isActive              Boolean  @default(true)
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@map("sample_tech_stacks")
}